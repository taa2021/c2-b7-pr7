# # C2.B7 Проектная работа 7. Система сборки Docker


## Задание

Оригинальная формулировка задания приведена [здесь](./TASK.md).

## Примечания к решению

- Логин, пароль доступа к базе включены в docker-образ в соответствии с логикой самого предложения, предложенного к установке.
  Процесс выполнен сугубо в учебных целях для задачи с иными целями демонстрации, отличными от выполнения
  лучших практик по безопасности инфмормации
- В git-репозитории в файле web.py приложения синтаксическая ошибка (лишний перевод строк) "патчится" налету при "раскатке" приложения
- Для гибкости файл web.py flask-приложения в docker-образе переименован в app.py,
  что позволяет в том числе удобно менять порт запуска приложения в docker-контейнере при запуске контейнера

## Ход решения (принципиальная схема развертывания)

0. Правим настройки создания сервера в Terraform, развертывания приложения (блок vars)
```
vi ansible-0-provision-playbook.yml
vi ansible-1-deploy-playbook.yml
```

1. Создаем сервер для решения [задания](./TASK.md)
```
ansible-playbook -i ansible-0-provision-inventory.txt ansible-0-provision-playbook.yml  | tee out/ansible-0-provision-apply.log
```

2. Настраиваем сервер, развертываем приложение, тестируем работоспособность приложения в соответствии с критериями [задания](./TASK.md)
```
ansible-playbook -i ansible-1-deploy-inventory.txt ansible-1-deploy-playbook.yml | tee out/ansible-1-deploy-apply.log
```

3. Отдельно, дополнительно повторяем тестирование работоспособности приложения в соответствии с критериями [задания](./TASK.md)
```
ansible-playbook -i ansible-1-deploy-inventory.txt ansible-2-test-playbook.yml | tee out/ansible-2-test-apply.log
```

4. Итоги развертывания:
- скриншот с работающим приложением и размер образа - [здесь](https://disk.yandex.ru/i/9vq5i-Q_kjz90Q);
- Dockerfile - [здесь](https://github.com/taa2021/c2-b7-pr7/blob/main/out/Dockerfile);
- ход развертывания сервера - [здесь](https://github.com/taa2021/c2-b7-pr7/blob/main/out/ansible-0-provision-apply.log);
- ход настройки сервера и развертывания приложения - [здесь](https://github.com/taa2021/c2-b7-pr7/blob/main/out/ansible-1-deploy-apply.log);
- результаты проверки правильности развертывания приложения - [здесь](https://github.com/taa2021/c2-b7-pr7/blob/main/out/ansible-2-test-apply.log).

## Выводы по решению

- Хост в Яндекс.Облаке (далее - vm) - развернут.
- На vm - установлен и запущен docker.
- На vm - установлен и запущен PostgreSQL.
- На vm для СУБД PostgreSQL - создана база данных, пользователь базы данных с польными правами на базу для docker-приложения.
- На основе базового минимального образа с фиксированной минорной версией python:3.10-alpine с минимизированным количеством слоев, с предусмотренным вариантом задания параметров запуска контейнера создан docker-образ приложения
- На основе созданного ранее docker-образа приложения запущен docker-контейнер с заданными заданием параметрами
- Развертывание приложения, работа приложения - протестированы с результатом: успешно.
